<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xô Phim - PHIM HAY CẢ XÔ </title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --xo-vang: #d4a017; --bg-dark: #0b0c10; }
        body { background-color: var(--bg-dark); color: #e2e8f0; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        
        #header { 
            position: fixed; top: 0; left: 0; width: 100%; z-index: 120;
            background: linear-gradient(to bottom, rgba(160, 0, 0, 0.98) 0%, rgba(130, 0, 0, 0.85) 60%, transparent 100%);
            padding: 15px 20px 30px 20px;
        }

        .search-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px; padding: 8px 15px;
            display: flex; align-items: center; gap: 10px; width: 100%; max-width: 400px;
        }
        .search-bar input { background: transparent; border: none; outline: none; color: white; font-size: 14px; width: 100%; }

        .nav-scroll {
            display: flex; overflow-x: visible; 
            gap: 20px; padding: 15px 0 0 0;
        }
        .nav-item { color: rgba(255,255,255,0.9); font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: 0.3s; cursor: pointer; }
        .nav-item:hover { color: var(--xo-vang); }

        /* MEGA MENU STYLE */
        .nav-item-container { position: relative; }
        .mega-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: rgba(15, 17, 26, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 Cột như ảnh */
            gap: 15px 25px;
            width: 550px;
            visibility: hidden;
            opacity: 0;
            transition: all 0.2s ease;
            z-index: 150;
            backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .nav-item-container:hover .mega-menu {
            visibility: visible;
            opacity: 1;
            transform: translateY(5px);
        }
        .mega-item {
            color: #cbd5e1;
            font-size: 13px;
            transition: 0.2s;
            cursor: pointer;
            white-space: nowrap;
        }
        .mega-item:hover { color: var(--xo-vang); transform: translateX(3px); }

        .badge-new { background: #f59e0b; color: #000; font-size: 9px; padding: 1px 4px; border-radius: 3px; font-weight: 900; }

        /* Các style khác giữ nguyên */
        .topic-card { min-width: 160px; height: 90px; border-radius: 16px; display: flex; flex-direction: column; justify-content: space-between; transition: 0.3s; cursor: pointer; padding: 15px; }
        .footer { background: #060709; padding: 60px 20px; border-top: 1px solid rgba(255,255,255,0.05); position: relative; }
        .sakura { position: fixed; top: -10%; z-index: 100; pointer-events: none; background: #ffb7c5; border-radius: 50% 0 50% 50%; animation: fall linear infinite; }
        @keyframes fall { 100% { transform: translateY(110vh) rotate(720deg); opacity: 0; } }
        #fw-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 90; }
        .thumb-item { width: 45px; height: 45px; border-radius: 50%; overflow: hidden; cursor: pointer; border: 2px solid transparent; transition: 0.3s; opacity: 0.5; }
        .thumb-item.active { border-color: white; opacity: 1; transform: scale(1.1); }
    </style>
</head>
<body>

    <canvas id="fw-canvas"></canvas>

    <header id="header">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div onclick="location.reload()" class="flex items-center justify-between w-full md:w-auto cursor-pointer">
                <div class="flex items-center gap-2">
                    <div class="w-9 h-8 bg-[#d4a017] rounded-b-xl flex items-center justify-center">
                        <i class="fas fa-play text-black text-xs"></i>
                    </div>
                    <div class="flex flex-col leading-none">
                        <span class="text-xl font-black text-white tracking-tighter uppercase">XÔ PHIM</span>
                        <span class="text-[8px] text-gray-400 font-bold tracking-widest uppercase">Đức Anh Đẹp Trai</span>
                    </div>
                </div>
            </div>
            <div class="search-bar">
                <i class="fas fa-search text-gray-400 text-sm"></i>
                <input type="text" id="searchInput" placeholder="Tìm phim (Nhấn Enter)..." onkeypress="if(event.key === 'Enter') searchMovies(this.value)">
            </div>
            <div class="hidden md:block">
                <button class="bg-white text-black px-4 py-1.5 rounded-full text-xs font-bold flex items-center gap-2">
                    <i class="fas fa-user text-[10px]"></i> Thành viên
                </button>
            </div>
        </div>

        <nav class="nav-scroll">
            <a href="#" onclick="location.reload()" class="nav-item">Motchill</a>
            <a href="#" onclick="searchMovies('Phim Bộ')" class="nav-item">Phim Bộ</a>
            <a href="#" onclick="searchMovies('Hoạt Hình')" class="nav-item">Hoạt Hình</a>
            <a href="#" onclick="searchMovies('Phim Lẻ')" class="nav-item">Phim Lẻ</a>
            
            <div class="nav-item-container">
                <div class="nav-item">Năm <i class="fas fa-caret-down text-[10px]"></i></div>
                <div class="mega-menu" style="width: 150px; grid-template-columns: 1fr;">
                    <div class="mega-item" onclick="searchMovies('2025')">Năm 2025</div>
                    <div class="mega-item" onclick="searchMovies('2024')">Năm 2024</div>
                    <div class="mega-item" onclick="searchMovies('2023')">Năm 2023</div>
                </div>
            </div>

            <div class="nav-item-container">
                <div class="nav-item text-yellow-500 font-bold">Thể Loại <i class="fas fa-caret-down text-[10px]"></i></div>
                <div class="mega-menu">
                    <div class="mega-item" onclick="searchMovies('Chính kịch')">Chính kịch</div>
                    <div class="mega-item" onclick="searchMovies('Hài Hước')">Hài Hước</div>
                    <div class="mega-item" onclick="searchMovies('Hành Động')">Hành Động</div>
                    <div class="mega-item" onclick="searchMovies('Tình Cảm')">Tình Cảm</div>
                    
                    <div class="mega-item" onclick="searchMovies('Viễn Tưởng')">Viễn Tưởng</div>
                    <div class="mega-item" onclick="searchMovies('Phiêu Lưu')">Phiêu Lưu</div>
                    <div class="mega-item" onclick="searchMovies('Hình Sự')">Hình Sự</div>
                    <div class="mega-item" onclick="searchMovies('Bí ẩn')">Bí ẩn</div>
                    
                    <div class="mega-item" onclick="searchMovies('Chiến Tranh')">Chiến Tranh</div>
                    <div class="mega-item" onclick="searchMovies('Khoa Học')">Khoa Học</div>
                    <div class="mega-item" onclick="searchMovies('Kinh Dị')">Kinh Dị</div>
                    <div class="mega-item" onclick="searchMovies('Cổ Trang')">Cổ Trang</div>
                </div>
            </div>

            <div class="nav-item-container">
                <div class="nav-item">Quốc Gia <i class="fas fa-caret-down text-[10px]"></i></div>
                <div class="mega-menu" style="width: 250px; grid-template-columns: repeat(2, 1fr);">
                    <div class="mega-item" onclick="searchMovies('Trung Quốc')">Trung Quốc</div>
                    <div class="mega-item" onclick="searchMovies('Hàn Quốc')">Hàn Quốc</div>
                    <div class="mega-item" onclick="searchMovies('Âu Mỹ')">Âu Mỹ</div>
                    <div class="mega-item" onclick="searchMovies('Nhật Bản')">Nhật Bản</div>
                </div>
            </div>

            <a href="#" class="nav-item">Thêm <i class="fas fa-caret-down text-[10px]"></i></a>
        </nav>
    </header>

    <section id="banner-section" class="relative h-[85vh] w-full pt-32 overflow-hidden">
        <div id="banner-bg" class="absolute inset-0 bg-cover bg-center transition-all duration-1000 scale-105 opacity-60"></div>
        <div class="absolute inset-0" style="background: linear-gradient(to top, var(--bg-dark) 5%, transparent 100%), linear-gradient(to right, rgba(0,0,0,0.8) 0%, transparent 60%);"></div>
        <div class="relative z-10 flex flex-col items-start justify-end h-full px-10 pb-20 max-w-4xl text-left">
            <h1 id="title" class="text-4xl md:text-6xl font-black mb-2 text-white drop-shadow-lg leading-tight uppercase italic">ĐANG TẢI...</h1>
            <p id="sub" class="text-yellow-500 text-lg font-bold mb-4 italic">--</p>
            <div id="info-badges" class="flex flex-wrap gap-2 mb-4"></div>
            <p id="desc" class="text-gray-300 text-sm md:text-base mb-8 line-clamp-3 max-w-2xl leading-relaxed">Vui lòng đợi giây lát để hệ thống lấy dữ liệu phim mới nhất.</p>
            <div class="flex flex-col gap-6">
                <div class="flex items-center gap-4">
                    <button onclick="playCurrent()" class="bg-yellow-500 text-black px-10 py-3 rounded-full font-black hover:scale-110 transition shadow-lg flex items-center gap-2">
                        <i class="fas fa-play"></i> XEM NGAY
                    </button>
                    <button class="w-12 h-12 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center hover:bg-white/20 transition">
                        <i class="far fa-heart text-white"></i>
                    </button>
                </div>
                <div id="banner-thumbs" class="flex gap-3"></div>
            </div>
        </div>
    </section>

    <main class="px-6 pb-20 mt-10">
        <h2 id="grid-title" class="text-xl font-extrabold italic uppercase mb-8 border-l-4 border-red-600 pl-4">Phim Mới Cập Nhật</h2>
        <div id="movie-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-6"></div>
    </main>

    <script>
        // Copy lại toàn bộ phần script xử lý API v3 và hiệu ứng từ phiên bản trước mình đã gửi cho bạn
        let movies = []; let cur = 0; let bannerInterval;
        async function fetchInitialMovies() {
            try {
                const res = await fetch('https://phimapi.com/danh-sach/phim-moi-cap-nhat-v3?page=1');
                const data = await res.json();
                processData(data.items);
            } catch (e) { console.error("Lỗi API", e); }
        }
        async function searchMovies(keyword) {
            if(!keyword) return;
            document.getElementById('grid-title').innerText = `Kết quả: ${keyword}`;
            window.scrollTo({top: 500, behavior: 'smooth'});
            try {
                const res = await fetch(`https://phimapi.com/v1/api/tim-kiem?keyword=${keyword}&limit=12`);
                const data = await res.json();
                processData(data.data.items);
            } catch (e) { alert("Không tìm thấy phim!"); }
        }
        function processData(items) {
            movies = items.map(item => ({
                title: item.name, sub: item.origin_name,
                img: item.poster_url || item.thumb_url,
                year: item.year || "2026", slug: item.slug,
                desc: item.content ? item.content.replace(/<[^>]*>?/gm, '').substring(0, 150) + "..." : "Thưởng thức tại Xô Phim."
            }));
            init();
        }
        function init() {
            const grid = document.getElementById('movie-grid');
            const thumbBox = document.getElementById('banner-thumbs');
            grid.innerHTML = ""; thumbBox.innerHTML = "";
            movies.forEach((m, i) => {
                grid.innerHTML += `<div class="cursor-pointer group" onclick="playMovie(${i})">
                    <div class="relative aspect-[2/3] rounded-xl overflow-hidden shadow-2xl bg-gray-900">
                        <img src="${m.img}" class="w-full h-full object-cover group-hover:scale-110 transition duration-700">
                    </div>
                    <h3 class="mt-3 font-bold text-xs truncate text-gray-300 group-hover:text-yellow-500 transition">${m.title}</h3>
                </div>`;
                if (i < 5) thumbBox.innerHTML += `<div class="thumb-item" onclick="updateBanner(${i})"><img src="${m.img}" class="w-full h-full object-cover"></div>`;
            });
            updateBanner(0);
        }
        function updateBanner(index) {
            if (movies.length === 0) return;
            cur = index; const m = movies[cur];
            document.getElementById('banner-bg').style.backgroundImage = `url('${m.img}')`;
            document.getElementById('title').innerText = m.title;
            document.getElementById('sub').innerText = m.sub;
            document.getElementById('desc').innerText = m.desc;
            document.getElementById('info-badges').innerHTML = `<span class="bg-yellow-600 text-black px-2 py-0.5 rounded text-xs font-bold uppercase">HOT</span><span class="border border-gray-500 px-2 py-0.5 rounded text-xs text-white font-medium">${m.year}</span>`;
        }
        fetchInitialMovies();
    </script>
</body>
</html>
