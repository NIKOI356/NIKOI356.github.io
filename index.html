<script>
    const movies = [
        {
            id: 0,
            title: "Đường Cung Kỳ Án",
            sub: "Unveil: Jadewind",
            year: "2026",
            rating: "9.2",
            status: "Phần 1 - Tập 5",
            desc: "Vào tiết Nguyên Tiêu, công chúa Ninh Viễn chết một cách kỳ lạ. Lý Bội Nghi của Nội Yết Cục và Thái Sử Thừa Tiêu Ly Cẩn phụng mệnh điều tra...",
            img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20260205-1/365d6e501c0e0d6263f51b0225429670.jpg",
            episodes: [
                { name: "Tập 01", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260205/lru6VjhD/index.m3u8" },
                { name: "Tập 02", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260205/EgJhi0qY/index.m3u8" },
                { name: "Tập 03", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260205/bd3s3dd1/index.m3u8" },
                { name: "Tập 04", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260205/shTS8xWn/index.m3u8" },
                { name: "Tập 05", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260206/K3KwyMw2/index.m3u8" }
            ]
        },
        {
            id: 1,
            title: "Cậu Bé Mất Tích",
            sub: "Stranger Things (Full Season 1-5)",
            year: "2016-2026",
            rating: "8.7",
            status: "Trọn bộ 5 phần",
            desc: "Khi một cậu bé mất tích, một thị trấn nhỏ phát hiện ra một bí ẩn liên quan đến các cuộc thí nghiệm bí mật, các lực lượng siêu nhiên đáng sợ và một cô bé kỳ lạ có khả năng thấu thị.",
            img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20251127-1/4e76c982472d25b28d2b8b0a177f79d7.jpg",
            episodes: [
                { name: "P1-T1", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/eMrQhses/index.m3u8" },
                { name: "P1-T2", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/yAIeQK28/index.m3u8" },
                { name: "P1-T3", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/bMLS6ssd/index.m3u8" },
                { name: "P1-T4", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/9GOe0ERm/index.m3u8" },
                { name: "P1-T5", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/dt44QZBb/index.m3u8" },
                { name: "P1-T6", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/rJDxkKag/index.m3u8" },
                { name: "P1-T7", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/GHYwItQu/index.m3u8" },
                { name: "P1-T8", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/T9dfPeqG/index.m3u8" },
                { name: "P2-T1", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/VpgRLCmQ/index.m3u8" },
                { name: "P2-T2", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/i4PjdUKJ/index.m3u8" },
                { name: "P2-T3", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/im9N0WA8/index.m3u8" },
                { name: "P2-T4", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/97X0NbJ9/index.m3u8" },
                { name: "P2-T5", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/hD5hYx5P/index.m3u8" },
                { name: "P2-T6", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/MUqTKn3z/index.m3u8" },
                { name: "P2-T7", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/devEf5D4/index.m3u8" },
                { name: "P2-T8", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/PyYxRkFF/index.m3u8" },
                { name: "P2-T9", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/QfegEzof/index.m3u8" },
                { name: "P3-T1", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/0VT1ek7V/index.m3u8" },
                { name: "P3-T2", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/4ALbRK0U/index.m3u8" },
                { name: "P3-T3", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/hCnt5Db7/index.m3u8" },
                { name: "P3-T4", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/R22LSZ4q/index.m3u8" },
                { name: "P3-T5", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/iB3IqIsM/index.m3u8" },
                { name: "P3-T6", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/K3fOBZ4T/index.m3u8" },
                { name: "P3-T7", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/q5z1E9jN/index.m3u8" },
                { name: "P3-T8", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/ZwVz0i1P/index.m3u8" },
                { name: "P4-T1", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/xlXYIN4h/index.m3u8" },
                { name: "P4-T2", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/DmcR4Ifa/index.m3u8" },
                { name: "P4-T3", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/s8HrgFqu/index.m3u8" },
                { name: "P4-T4", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/CnoWNGQP/index.m3u8" },
                { name: "P4-T5", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/2Z4dBijs/index.m3u8" },
                { name: "P4-T6", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/74OVKIPn/index.m3u8" },
                { name: "P4-T7", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/pHLmU9j0/index.m3u8" },
                { name: "P4-T8", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/bN2uJOQG/index.m3u8" },
                { name: "P4-T9", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/wlTpiDT6/index.m3u8" },
                { name: "P5-T1", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/VdVcTjll/index.m3u8" },
                { name: "P5-T2", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/Xaex73oM/index.m3u8" },
                { name: "P5-T3", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/phZU5qEk/index.m3u8" },
                { name: "P5-T4", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/JudV0Ni1/index.m3u8" },
                { name: "P5-T5", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251226/AFjYGQ1K/index.m3u8" },
                { name: "P5-T6", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251226/TPpFJBKF/index.m3u8" },
                { name: "P5-T7", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251226/oxQZbDQo/index.m3u8" },
                { name: "P5-T8", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260101/YyOnJ03e/index.m3u8" }
            ]
        },
        {
            id: 4,
            title: "Hố Đen Tử Thần",
            sub: "Interstellar",
            year: "2014",
            rating: "8.7",
            status: "Full HD",
            desc: "Trong tương lai, khi Trái Đất bị tàn phá bởi hạn hán và biến đổi khí hậu...",
            img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20250302-1/4cee31c3afd0fbfd11ed4f14b1bfd816.jpg",
            episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s4.phim1280.tv/20250302/BLbAWQOK/index.m3u8" }]
        },
        {
            id: 2,
            title: "Bóng Ma Anh Quốc",
            sub: "Peaky Blinders",
            year: "2024",
            rating: "8.8",
            status: "Trọn bộ 6 phần",
            desc: "Một băng đảng tội phạm khét tiếng ở Birmingham, Anh, vào năm 1919...",
            img: "https://phimimg.com/upload/vod/20240730-1/6c17cbb10c2284bb6001e4a8a79ad786.jpg",
            episodes: [{ name: "Tập 01", link: "#" }]
        },
        {
            id: 3,
            title: "Sói Già Phố Wall",
            sub: "The Wolf of Wall Street",
            year: "2013",
            rating: "8.2",
            status: "Phim Lẻ",
            desc: "Dựa trên câu chuyện có thật của Jordan Belfort...",
            img: "https://phimimg.com/upload/vod/20231018-1/2e6fd68d5e7002fcc9fa6b8453242a8a.jpg",
            episodes: [{ name: "Full", link: "#" }]
        }
    ];

    let currentIndex = 0;
    let slideInterval;

    function updateBanner() {
        const m = movies[currentIndex];
        const infoBox = document.getElementById('movie-info-content');
        
        infoBox.style.opacity = 0;
        setTimeout(() => {
            document.getElementById('banner-bg').style.backgroundImage = `url('${m.img}')`;
            document.getElementById('movie-title').innerText = m.title;
            document.getElementById('movie-sub').innerText = m.sub;
            document.getElementById('movie-year').innerText = m.year;
            document.getElementById('movie-rating').innerText = `IMDb ${m.rating}`;
            document.getElementById('movie-status').innerText = m.status;
            document.getElementById('movie-desc').innerText = m.desc;
            
            infoBox.style.opacity = 1;
            infoBox.classList.remove('animate-fade');
            void infoBox.offsetWidth;
            infoBox.classList.add('animate-fade');
        }, 300);

        document.querySelectorAll('.thumb-circle').forEach((t, i) => {
            t.classList.toggle('thumb-active', i === currentIndex);
        });
    }

    function openPlayer(movieIdx) {
        const movie = movies[movieIdx];
        const overlay = document.getElementById('movie-overlay');
        const epGrid = document.getElementById('episode-grid');
        
        document.getElementById('player-title').innerText = movie.title;
        document.getElementById('player-desc').innerText = movie.desc;
        
        epGrid.innerHTML = movie.episodes.map((ep, i) => `
            <button onclick="playEpisode('${ep.link}', '${ep.name}', this)" 
                    class="ep-btn border border-white/10 py-2 rounded text-[11px] font-bold hover:bg-yellow-500 hover:text-black transition ${i===0 ? 'active' : ''}">
                ${ep.name}
            </button>
        `).join('');

        if(movie.episodes.length > 0) {
            playEpisode(movie.episodes[0].link, movie.episodes[0].name);
        }

        overlay.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function playEpisode(link, name, btnElement = null) {
        document.getElementById('video-iframe').src = link;
        document.getElementById('player-ep-name').innerText = `Đang xem: ${name}`;
        
        if(btnElement) {
            document.querySelectorAll('.ep-btn').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
        }
    }

    function closePlayer() {
        document.getElementById('movie-overlay').classList.add('hidden');
        document.getElementById('video-iframe').src = "";
        document.body.style.overflow = 'auto';
    }

    function renderMovieGrid() {
        document.getElementById('movie-grid').innerHTML = movies.map((m, i) => `
            <div class="movie-card group cursor-pointer" onclick="openPlayer(${i})">
                <div class="relative aspect-[2/3] overflow-hidden rounded-xl bg-gray-800">
                    <img src="${m.img}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                    <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <div class="w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center text-black shadow-lg shadow-yellow-500/30 transform scale-50 group-hover:scale-100 transition-transform">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                    <div class="absolute top-2 left-2 flex flex-col gap-1">
                        <span class="bg-yellow-500 text-black text-[10px] font-black px-1.5 py-0.5 rounded italic">IMDb ${m.rating}</span>
                    </div>
                    <div class="absolute bottom-2 right-2">
                        <span class="bg-black/70 backdrop-blur-sm text-white text-[10px] px-2 py-1 rounded border border-white/10">${m.status}</span>
                    </div>
                </div>
                <div class="mt-3 px-1">
                    <h3 class="text-sm font-bold truncate group-hover:text-yellow-500 transition">${m.title}</h3>
                    <p class="text-[11px] text-gray-500 truncate italic">${m.sub}</p>
                </div>
            </div>
        `).join('');
    }

    function initThumbs() {
        const thumbContainer = document.getElementById('thumb-container');
        thumbContainer.innerHTML = '';
        movies.forEach((m, i) => {
            const t = document.createElement('div');
            t.className = `thumb-circle ${i === 0 ? 'thumb-active' : ''}`;
            t.innerHTML = `<img src="${m.img}" class="w-full h-full object-cover">`;
            t.onclick = () => { currentIndex = i; updateBanner(); startTimer(); };
            thumbContainer.appendChild(t);
        });
    }

    window.addEventListener('scroll', () => {
        const header = document.getElementById('header');
        header.classList.toggle('bg-[#1a1a20]', window.scrollY > 100);
    });

    function startTimer() {
        clearInterval(slideInterval);
        slideInterval = setInterval(() => {
            currentIndex = (currentIndex + 1) % movies.length;
            updateBanner();
        }, 5000);
    }

    initThumbs();
    updateBanner();
    renderMovieGrid();
    startTimer();
</script>
