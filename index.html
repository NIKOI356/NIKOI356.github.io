<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoPhim - Giao diện Phân Tách</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <style>
        body { background-color: #0f1115; color: white; font-family: sans-serif; }
        .banner-gradient { background: linear-gradient(to right, #0f1115 15%, rgba(15,17,21,0.7) 45%, transparent 100%); }
        .info-tag { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.15); padding: 3px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; }
        .imdb-tag { border-color: #eab308; color: #eab308; }
        
        /* Player Styles */
        #player-overlay { transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        .episode-btn { background: #1e2129; border-radius: 8px; transition: 0.2s; border: 1px solid transparent; }
        .episode-btn.active { background: #facc15 !important; color: #000 !important; font-weight: bold; }
        
        .format-tab { cursor: pointer; padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 700; color: #6b7280; border: 1px solid transparent; }
        .format-tab.active { color: white; border-color: rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); }
    </style>
</head>
<body>

    <header class="fixed w-full z-50 flex items-center justify-between px-6 py-4 bg-gradient-to-b from-black/60 to-transparent">
        <div class="flex items-center gap-10">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center text-black"><i class="fas fa-play text-xs"></i></div>
                <div><h1 class="font-bold text-xl leading-none">RoPhim</h1><p class="text-[9px] text-gray-400">Phim hay cả rổ</p></div>
            </div>
            <nav class="hidden lg:flex gap-6 text-sm font-semibold text-gray-300">
                <a href="#">Chủ đề</a><a href="#">Thể loại</a><a href="#">Phim Lẻ</a><a href="#">Phim Bộ</a>
            </nav>
        </div>
        <div class="flex items-center gap-4 bg-black/40 border border-white/10 px-4 py-2 rounded-xl">
            <i class="fas fa-search text-gray-400"></i>
            <input type="text" placeholder="Tìm kiếm phim..." class="bg-transparent outline-none text-xs w-40">
        </div>
    </header>

    <div class="swiper mySwiper h-screen w-full">
        <div class="swiper-wrapper" id="banner-render"></div>
    </div>

    <div id="player-overlay" class="fixed inset-0 bg-[#0f1115] translate-y-full overflow-y-auto z-[100]">
        <div class="sticky top-0 bg-[#0f1115]/95 backdrop-blur-lg p-4 flex justify-between items-center z-50 border-b border-white/5">
            <div class="flex items-center gap-3"><div class="w-2 h-2 bg-red-500 rounded-full animate-ping"></div><span id="player-title" class="text-xs font-black uppercase text-gray-400">Đang tải...</span></div>
            <button onclick="closePlayer()" class="w-10 h-10 hover:bg-white/10 rounded-full transition"><i class="fas fa-times"></i></button>
        </div>

        <div class="w-full aspect-video bg-black shadow-inner">
            <iframe id="main-iframe" class="w-full h-full" src="" frameborder="0" allowfullscreen></iframe>
        </div>

        <div class="max-w-7xl mx-auto p-6 md:p-12">
            <div class="flex flex-col md:flex-row md:items-center gap-8 py-6 border-b border-white/5 mb-8">
                <div class="flex items-center gap-3">
                    <i class="fas fa-list-ul text-yellow-500"></i>
                    <select id="sel-season" onchange="updateEpisodeGrid()" class="bg-transparent text-xl font-bold outline-none cursor-pointer"></select>
                </div>
                <div class="flex gap-2" id="format-container">
                    </div>
            </div>
            <div id="grid-eps" class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-4"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        // --- LOGIC XỬ LÝ (TRÌNH ĐIỀU KHIỂN) ---
        let currentMovie = null;

        function initApp() {
            const container = document.getElementById('banner-render');
            movies.forEach(m => {
                container.innerHTML += `
                    <div class="swiper-slide relative">
                        <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('${m.img}')"></div>
                        <div class="absolute inset-0 banner-gradient"></div>
                        <div class="relative z-10 flex flex-col justify-center h-full px-8 md:px-20 max-w-4xl">
                            <h2 class="text-5xl font-black mb-4">${m.title}</h2>
                            <p class="text-yellow-500 font-bold text-sm mb-6 uppercase tracking-widest">${m.subTitle}</p>
                            <div class="flex gap-3 mb-6">
                                <span class="info-tag imdb-tag">IMDb ${m.imdb}</span>
                                <span class="info-tag">${m.year}</span>
                                <span class="info-tag">Tập ${m.totalEps}</span>
                            </div>
                            <p class="text-gray-400 text-sm leading-relaxed mb-10 line-clamp-3">${m.desc}</p>
                            <button onclick="openPlayer(${m.id})" class="w-16 h-16 bg-yellow-500 text-black rounded-full flex items-center justify-center text-2xl shadow-2xl shadow-yellow-500/40 hover:scale-110 transition">
                                <i class="fas fa-play ml-1"></i>
                            </button>
                        </div>
                    </div>`;
            });
            new Swiper(".mySwiper", { loop: true, autoplay: { delay: 4000 } });
        }

        function openPlayer(id) {
            currentMovie = movies.find(m => m.id === id);
            const sel = document.getElementById('sel-season');
            const seasons = [...new Set(currentMovie.episodes.map(e => e.season))];
            sel.innerHTML = seasons.map(s => `<option class="bg-[#1e2129]" value="${s}">${s}</option>`).join('');
            
            updateFormats();
            document.getElementById('player-overlay').classList.remove('translate-y-full');
            document.body.style.overflow = 'hidden';
        }

        function updateFormats() {
            const container = document.getElementById('format-container');
            const formats = [...new Set(currentMovie.episodes.map(e => e.format))];
            container.innerHTML = formats.map((f, i) => `
                <div class="format-tab ${i===0?'active':''}" onclick="setActiveFormat(this, '${f}')">
                    <i class="${f.includes('Thuyết')?'fas fa-microphone':'far fa-closed-captioning'}"></i> ${f}
                </div>`).join('');
            updateEpisodeGrid();
        }

        function setActiveFormat(el, formatName) {
            document.querySelectorAll('.format-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            updateEpisodeGrid(formatName);
        }

        function updateEpisodeGrid(filterFormat = null) {
            const season = document.getElementById('sel-season').value;
            const format = filterFormat || document.querySelector('.format-tab.active').innerText.trim();
            const grid = document.getElementById('grid-eps');
            grid.innerHTML = '';

            const filtered = currentMovie.episodes.filter(e => e.season === season && e.format === format);
            filtered.forEach((ep, i) => {
                const btn = document.createElement('button');
                btn.className = 'episode-btn py-4 text-xs font-bold';
                btn.innerHTML = `<i class="fas fa-play text-[8px] opacity-30"></i> ${ep.name}`;
                btn.onclick = () => {
                    document.getElementById('main-iframe').src = ep.url;
                    document.querySelectorAll('.episode-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById('player-title').innerText = `${currentMovie.title} - ${ep.name} (${format})`;
                };
                grid.appendChild(btn);
                if(i === 0) btn.click();
            });
        }

        function closePlayer() {
            document.getElementById('player-overlay').classList.add('translate-y-full');
            document.getElementById('main-iframe').src = '';
            document.body.style.overflow = 'auto';
        }

        initApp();
    </script>
</body>
</html>
