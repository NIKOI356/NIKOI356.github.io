<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xô Phim - PHIM HAY CẢ XÔ </title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --xo-vang: #d4a017; --bg-dark: #0b0c10; }
        body { background-color: var(--bg-dark); color: #e2e8f0; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        
        #header { 
            position: fixed; top: 0; left: 0; width: 100%; z-index: 120;
            background: linear-gradient(to bottom, rgba(160, 0, 0, 0.98) 0%, rgba(130, 0, 0, 0.85) 60%, transparent 100%);
            padding: 15px 20px 30px 20px;
        }

        .search-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px; padding: 8px 15px;
            display: flex; align-items: center; gap: 10px; width: 100%; max-width: 400px;
        }
        .search-bar input { background: transparent; border: none; outline: none; color: white; font-size: 14px; width: 100%; }

        .nav-scroll {
            display: flex; overflow-x: auto; white-space: nowrap;
            gap: 20px; padding: 15px 0 0 0; scrollbar-width: none;
        }
        .nav-scroll::-webkit-scrollbar { display: none; }
        .nav-item { color: rgba(255,255,255,0.9); font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: 0.3s; cursor: pointer; }
        .nav-item:hover { color: var(--xo-vang); }
        .badge-new { background: #f59e0b; color: #000; font-size: 9px; padding: 1px 4px; border-radius: 3px; font-weight: 900; }

        .topic-card { min-width: 160px; height: 90px; border-radius: 16px; display: flex; flex-direction: column; justify-content: space-between; transition: 0.3s; cursor: pointer; padding: 15px; }
        .topic-card:hover { transform: translateY(-5px); filter: brightness(1.2); }

        .footer { background: #060709; padding: 60px 20px; border-top: 1px solid rgba(255,255,255,0.05); position: relative; }
        .footer-tag { background: #900; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; display: inline-block; margin-bottom: 20px; }
        .social-icons { display: flex; gap: 12px; margin: 20px 0; }
        .social-icons a { width: 35px; height: 35px; border-radius: 50%; background: rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .social-icons a:hover { background: var(--xo-vang); color: black; }
        
        .btn-top { position: absolute; bottom: 30px; right: 20px; background: white; color: black; padding: 8px 12px; border-radius: 10px; font-weight: 900; font-size: 10px; text-align: center; cursor: pointer; }

        .sakura { position: fixed; top: -10%; z-index: 100; pointer-events: none; background: #ffb7c5; border-radius: 50% 0 50% 50%; animation: fall linear infinite; }
        @keyframes fall { 100% { transform: translateY(110vh) rotate(720deg); opacity: 0; } }

        #fw-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 90; }

        .thumb-item {
            width: 45px; height: 45px; border-radius: 50%; overflow: hidden; 
            cursor: pointer; border: 2px solid transparent; transition: 0.3s;
            opacity: 0.5;
        }
        .thumb-item.active { border-color: white; opacity: 1; transform: scale(1.1); }
        
        /* Loading Overlay */
        #loader {
            position: fixed; inset: 0; background: var(--bg-dark); z-index: 999;
            display: flex; justify-content: center; align-items: center; transition: 0.5s;
        }
    </style>
</head>
<body>

    <canvas id="fw-canvas"></canvas>

    <header id="header">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div onclick="location.reload()" class="flex items-center justify-between w-full md:w-auto">
                <div class="flex items-center gap-2 cursor-pointer">
                    <div class="w-9 h-8 bg-[#d4a017] rounded-b-xl flex items-center justify-center">
                        <i class="fas fa-play text-black text-xs"></i>
                    </div>
                    <div class="flex flex-col leading-none">
                        <span class="text-xl font-black text-white tracking-tighter uppercase">XÔ PHIM</span>
                        <span class="text-[8px] text-gray-400 font-bold tracking-widest uppercase">Đức Anh Đẹp Trai</span>
                    </div>
                </div>
            </div>
            <div class="search-bar">
                <i class="fas fa-search text-gray-400 text-sm"></i>
                <input type="text" id="searchInput" placeholder="Tìm phim (Nhấn Enter)..." onkeypress="if(event.key === 'Enter') searchMovies(this.value)">
            </div>
        </div>
        <nav class="nav-scroll">
            <div onclick="loadCustomMovies()" class="nav-item text-yellow-500 font-black"><i class="fas fa-fire"></i> PHIM YÊU CẦU</div>
            <a href="#" class="nav-item">Thể loại <i class="fas fa-caret-down text-[10px]"></i></a>
            <a href="#" class="nav-item">Phim Lẻ</a>
            <a href="#" class="nav-item">Phim Bộ</a>
            <a href="#" class="nav-item"><span class="badge-new">NEW</span> Xem Chung</a>
            <a href="#" class="nav-item">Quốc gia</a>
        </nav>
    </header>

    <section id="banner-section" class="relative h-[85vh] w-full pt-32 overflow-hidden">
        <div id="banner-bg" class="absolute inset-0 bg-cover bg-center transition-all duration-1000 scale-105 opacity-60"></div>
        <div class="absolute inset-0" style="background: linear-gradient(to top, var(--bg-dark) 5%, transparent 100%), linear-gradient(to right, rgba(0,0,0,0.8) 0%, transparent 60%);"></div>
        
        <div class="relative z-10 flex flex-col items-start justify-end h-full px-10 pb-20 max-w-4xl text-left">
            <h1 id="title" class="text-4xl md:text-6xl font-black mb-2 text-white drop-shadow-lg leading-tight uppercase italic">ĐANG TẢI...</h1>
            <p id="sub" class="text-yellow-500 text-lg font-bold mb-4 italic">--</p>
            
            <div id="info-badges" class="flex flex-wrap gap-2 mb-4"></div>
            <div id="genres" class="flex flex-wrap gap-2 mb-6"></div>
            <p id="desc" class="text-gray-300 text-sm md:text-base mb-8 line-clamp-3 max-w-2xl leading-relaxed">Vui lòng đợi giây lát để hệ thống lấy dữ liệu phim mới nhất.</p>
            
            <div class="flex flex-col gap-6">
                <div class="flex items-center gap-4">
                    <button onclick="playCurrent()" class="bg-yellow-500 text-black px-10 py-3 rounded-full font-black hover:scale-110 transition shadow-lg flex items-center gap-2">
                        <i class="fas fa-play"></i> XEM NGAY
                    </button>
                    <button class="w-12 h-12 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center hover:bg-white/20 transition">
                        <i class="far fa-heart text-white"></i>
                    </button>
                    <button class="w-12 h-12 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center hover:bg-white/20 transition">
                        <i class="fas fa-exclamation-circle text-white"></i>
                    </button>
                </div>
                
                <div id="banner-thumbs" class="flex gap-3"></div>
            </div>
        </div>
    </section>

    <section class="px-6 py-10">
        <h2 class="text-lg font-bold text-white mb-6 uppercase tracking-tight">Bạn đang quan tâm gì?</h2>
        <div class="flex overflow-x-auto gap-4 pb-4" style="scrollbar-width: none;">
            <div onclick="searchMovies('Marvel')" class="topic-card bg-blue-600"><span class="font-black italic text-lg">Marvel</span><span class="text-[10px] uppercase font-bold">Xem chủ đề <i class="fas fa-chevron-right"></i></span></div>
            <div onclick="searchMovies('Hoạt Hình')" class="topic-card bg-teal-600"><span class="font-black italic text-lg">Hoạt Hình</span><span class="text-[10px] uppercase font-bold">Xem chủ đề <i class="fas fa-chevron-right"></i></span></div>
            <div onclick="searchMovies('Hành Động')" class="topic-card bg-purple-600"><span class="font-black italic text-lg leading-tight">Hành Động<br>Cực Mạnh</span><span class="text-[10px] uppercase font-bold">Xem chủ đề <i class="fas fa-chevron-right"></i></span></div>
            <div onclick="loadCustomMovies()" class="topic-card bg-yellow-700"><span class="font-black italic text-lg">Đặc Sắc 2026</span><span class="text-[10px] uppercase font-bold">Xem chủ đề <i class="fas fa-chevron-right"></i></span></div>
            <div onclick="searchMovies('Kinh Dị')" class="topic-card bg-red-700"><span class="font-black italic text-lg">Kinh Dị</span><span class="text-[10px] uppercase font-bold">Xem chủ đề <i class="fas fa-chevron-right"></i></span></div>
            <div onclick="searchMovies('Hài Hước')" class="topic-card bg-indigo-700"><span class="font-black italic text-lg">Hài Hước</span><span class="text-[10px] uppercase font-bold">Xem chủ đề <i class="fas fa-chevron-right"></i></span></div>
        </div>
    </section>

    <main class="px-6 pb-20">
        <h2 id="grid-title" class="text-xl font-extrabold italic uppercase mb-8 border-l-4 border-red-600 pl-4">Phim Mới Cập Nhật</h2>
        <div id="movie-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-6"></div>
    </main>

    <footer class="footer">
        <div class="max-w-7xl mx-auto">
            <div class="footer-tag">★ Hoàng Sa & Trường Sa là của Việt Nam!</div>
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-9 bg-[#d4a017] rounded-b-xl flex items-center justify-center"><i class="fas fa-play text-black"></i></div>
                <div class="flex flex-col leading-none border-r border-gray-700 pr-4">
                    <span class="text-2xl font-black text-white uppercase">XÔ PHIM</span>
                    <span class="text-[10px] text-gray-400 font-bold">YIXIU VIETNAM</span>
                </div>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-telegram-plane"></i></a>
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-tiktok"></i></a>
                </div>
            </div>
            <p class="text-xs text-gray-500 leading-relaxed max-w-2xl">XôPhim - Trải nghiệm điện ảnh 4K tốt nhất 2026.</p>
            <p class="text-[10px] text-gray-600 mt-6 uppercase font-bold italic">© 2026 XôPhim - Đức Anh Đẹp Trai</p>
        </div>
        <div class="btn-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})"><i class="fas fa-arrow-up block mb-1"></i> ĐẦU<br>TRANG</div>
    </footer>

    <div id="player-overlay" class="fixed inset-0 z-[200] hidden bg-black flex flex-col">
        <div class="p-4 flex justify-between items-center bg-[#1a1a20]">
            <button onclick="closePlayer()" class="text-white text-xl hover:text-red-500 transition"><i class="fas fa-times"></i></button>
            <h2 id="player-title" class="font-bold text-xs text-gray-400 uppercase tracking-widest text-center flex-1">Đang phát</h2>
            <div class="w-6"></div>
        </div>
        <div id="episode-list" class="flex gap-2 p-2 overflow-x-auto bg-[#1a1a20] border-t border-gray-800"></div>
        <iframe id="main-iframe" class="flex-1 w-full" frameborder="0" allowfullscreen></iframe>
    </div>

    <script>
        // DỮ LIỆU PHIM CUSTOM CỦA BẠN
        const customData = [
            { id: 18, title: "Mưa Đỏ", sub: "Red Rain", year: "2026", rating: "8.2", status: "YouTube", desc: "Một tác phẩm mang đầy màu sắc nghệ thuật và kịch tính...", img: "https://mir-s3-cdn-cf.behance.net/project_modules/1400_webp/0b1372232709307.68a20d789415d.jpg", episodes: [{ name: "Full", link: "https://www.youtube.com/embed/9Ymlum6nHq4" }] },
            { id: 17, title: "Quang Phổ", sub: "Spectral", year: "2026", rating: "7.3", status: "Bản Đẹp", desc: "Một đội đặc nhiệm tinh nhuệ được cử đi thực hiện nhiệm vụ tại một thành phố đang bị tàn phá...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20260116-1/5b1f85f0fbcc96ca4bad610602025626.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260116/KvfgltMI/index.m3u8" }] },
            { id: 16, title: "Trò Chơi Kẻ Thao Túng", sub: "My Sister's Bones", year: "2026", rating: "7.6", status: "Phim Mới", desc: "Sau cái chết đột ngột của cha, hai chị em bị lôi kéo vào một trò chơi tâm lý đầy nguy hiểm...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20260202-1/90b04eb17f3d2b9b3afa7e90aac58e41.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260202/T8OE34Fr/index.m3u8" }] },
            { id: 15, title: "The Rig", sub: "The Rig", year: "2023", rating: "6.8", status: "Tập 06/06", desc: "Khi một màn sương mù bí ẩn bao vây giàn khoan dầu Kinloch Bravo...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20240305-1/af45b3557bc21dcdf87fbbf29423b3aa.jpg", episodes: [{ name: "Tập 01", link: "https://player.phimapi.com/player/?url=https://s2.phim1280.tv/20240311/EefofkOB/index.m3u8" }, { name: "Tập 06", link: "https://player.phimapi.com/player/?url=https://s2.phim1280.tv/20240311/DSFUnB7s/index.m3u8" }] },
            { id: 14, title: "Mật Vụ Phụ Hồ", sub: "A Working Man", year: "2025", rating: "7.8", status: "Hành Động", desc: "Câu chuyện xoay quanh một người đàn ông làm nghề phụ hồ bình dị nhưng ẩn sau đó là quá khứ bí ẩn...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20250406-1/7c28ab6d499bc41ee5ba9e33f265a7cc.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250509/o66izJ5l/index.m3u8" }] },
            { id: 13, title: "Siêu Anh Hùng Bloodshot", sub: "Bloodshot", year: "2020", rating: "7.0", status: "Bản Đẹp", desc: "Ray Garrison được hồi sinh bởi công nghệ nano siêu việt trong máu...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20250905-1/e4c64f54f35cd50c496d12d580284dac.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250905/rnRuM8V1/index.m3u8" }] },
            { id: 12, title: "Tiểu Yêu Quái Núi Lãng Lãng", sub: "Nobody", year: "2023", rating: "9.2", status: "Hoạt Hình", desc: "Góc nhìn mới mẻ về cuộc sống của một tiểu yêu quái bình thường...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20250907-1/4074dc1b02219548fd890c1a948dac70.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251204/wM0RTCwd/index.m3u8" }] },
            { id: 11, title: "Avatar: Lửa và Tro Tàn", sub: "Avatar: Fire and Ash", year: "2025", rating: "9.0", status: "Phim Chiếu Rạp", desc: "Phần 3 của siêu phẩm Avatar với bộ tộc Người Tro Tàn...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20251221-1/687373bb9894616507f27c74c0eaa598.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260120/H4h7Crrd/index.m3u8" }] },
            { id: 10, title: "Avatar 2: Dòng Chảy Của Nước", sub: "Avatar: The Way of Water", year: "2022", rating: "8.0", status: "Bản Đẹp 4K", desc: "Jake Sully học cách thích nghi với đại dương trên Pandora...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20250513-1/59fc5ffe0025ca40c99d48b070b59320.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250513/XQBfOc33/index.m3u8" }] },
            { id: 9, title: "Avatar 1", sub: "Avatar (2009)", year: "2009", rating: "7.9", status: "Siêu Kinh Điển", desc: "Hành trình bảo vệ Pandora của tộc người Na'vi...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20251224-1/a14e53706b8086d753874f16c0d232d3.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251224/r2a4Q0Z4/index.m3u8" }] },
            { id: 8, title: "Tên Trộm Dấu Yêu", sub: "To My Beloved Thief", year: "2026", rating: "8.5", status: "Tập 08/??", desc: "Chuyện tình kịch tính giữa một tên trộm tài ba và mục tiêu...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20260105-1/0adea2e823ede3d6a2bca22d1f0ac286.jpg", episodes: [{ name: "Tập 01", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260110/18klrYcR/index.m3u8" }, { name: "Tập 08", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260201/FqfQaMnQ/index.m3u8" }] },
            { id: 7, title: "Quái Vật Đầm Lầy", sub: "The Bayou", year: "2026", rating: "7.2", status: "Phim Mới", desc: "Một sinh vật bí ẩn và khát máu trỗi dậy từ vùng đầm lầy...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20250515-1/5787cec877bf6d532bfa6486468f914c.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250515/82qFdZP8/index.m3u8" }] },
            { id: 6, title: "Đảo Rắn Khổng Lồ", sub: "Island Python", year: "2026", rating: "7.5", status: "Phim Mới", desc: "Cuộc chiến sinh tồn trên hòn đảo của loài trăn khổng lồ...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20250204-1/4a2bea191ffbdf6af6c67d1a42b82695.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260206/3ywMSHEu/index.m3u8" }] },
            { id: 5, title: "Cậu Bé Mồ Côi", sub: "Oliver Twist", year: "2005", rating: "6.8", status: "Full HD", desc: "Hành trình tìm kiếm lương thiện của cậu bé Oliver...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20231101-1/6cbd98d6056b8ee79cdb701f9836e017.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s2.phim1280.tv/20231103/fUhNyikd/index.m3u8" }] },
            { id: 4, title: "Cậu Bé Mất Tích", sub: "Stranger Things", year: "2016-2026", rating: "8.7", status: "Full 5 Season", desc: "Bí ẩn tại thị trấn nhỏ liên quan các thí nghiệm siêu nhiên...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20251127-1/4e76c982472d25b28d2b8b0a177f79d7.jpg", episodes: [{ name: "P1-T1", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251127/eMrQhses/index.m3u8" }, { name: "P5-T8", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260101/YyOnJ03e/index.m3u8" }] },
            { id: 3, title: "Hố Đen Tử Thần", sub: "Interstellar", year: "2014", rating: "8.7", status: "Full HD", desc: "Nhóm du hành xuyên hố đen tìm kiếm sự sống mới...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20250302-1/4cee31c3afd0fbfd11ed4f14b1bfd816.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s4.phim1280.tv/20250302/BLbAWQOK/index.m3u8" }] },
            { id: 2, title: "Bóng Ma Anh Quốc", sub: "Peaky Blinders", year: "2013-2024", rating: "8.8", status: "Trọn bộ 5 phần", desc: "Băng đảng khét tiếng Birmingham dẫn dắt bởi Tommy Shelby...", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20240730-1/b37769fcc6142d1e116b6486f6b7132b.jpg", episodes: [{ name: "P1-T01", link: "https://player.phimapi.com/player/?url=https://s3.phim1280.tv/20240730/911phIUY/index.m3u8" }, { name: "P5-T06", link: "https://player.phimapi.com/player/?url=https://s3.phim1280.tv/20240730/av5MnBdn/index.m3u8" }] },
            { id: 1, title: "Sói Già Phố Wall", sub: "The Wolf of Wall Street", year: "2013", rating: "8.2", status: "Phim Lẻ", desc: "Dựa trên câu chuyện có thật của nhà môi giới Jordan Belfort...", img: "https://phimimg.com/upload/vod/20231018-1/2e6fd68d5e7002fcc9fa6b8453242a8a.jpg", episodes: [{ name: "Full", link: "https://player.phimapi.com/player/?url=https://s2.phim1280.tv/20231019/KZ3IDVB4/index.m3u8" }] }
        ];

        let movies = []; 
        let cur = 0;
        let bannerInterval;
        let isHovered = false;
        const AUTO_TIME = 4000; 

        // HÀM TẢI DANH SÁCH RIÊNG CỦA BẠN
        function loadCustomMovies() {
            document.getElementById('grid-title').innerHTML = `<i class="fas fa-star text-yellow-500"></i> PHIM ĐƯỢC YÊU CẦU RIÊNG`;
            window.scrollTo({top: 800, behavior: 'smooth'});
            
            // Xử lý dữ liệu về định dạng chung để render
            movies = customData.map(item => ({
                title: item.title,
                sub: item.sub,
                img: item.img,
                year: item.year,
                desc: item.desc,
                isCustom: true,
                episodes: item.episodes
            }));
            
            renderGrid();
            updateBanner(0);
        }

        async function fetchInitialMovies() {
            try {
                const res = await fetch('https://phimapi.com/danh-sach/phim-moi-cap-nhat?page=1');
                const data = await res.json();
                processData(data.items);
            } catch (e) { console.error("Lỗi API", e); }
        }

        async function searchMovies(keyword) {
            if(!keyword) return;
            document.getElementById('grid-title').innerText = `Kết quả: ${keyword}`;
            window.scrollTo({top: 800, behavior: 'smooth'});
            try {
                const res = await fetch(`https://phimapi.com/v1/api/tim-kiem?keyword=${keyword}&limit=12`);
                const data = await res.json();
                processData(data.data.items);
            } catch (e) { alert("Không tìm thấy phim!"); }
        }

        function processData(items) {
            movies = items.map(item => ({
                title: item.name,
                sub: item.origin_name,
                img: item.thumb_url.startsWith('http') ? item.thumb_url : `https://phimimg.com/${item.thumb_url}`,
                year: item.year || "2026",
                slug: item.slug,
                desc: "Chào mừng bạn đến với Xô Phim, hãy thưởng thức bộ phim này với chất lượng cao nhất."
            }));
            renderGrid();
            updateBanner(0);
            startBannerCycle();
        }

        function renderGrid() {
            const grid = document.getElementById('movie-grid');
            const thumbBox = document.getElementById('banner-thumbs');
            grid.innerHTML = "";
            thumbBox.innerHTML = "";
            
            movies.forEach((m, i) => {
                grid.innerHTML += `
                    <div class="cursor-pointer group" onclick="playMovie(${i})">
                        <div class="relative aspect-[2/3] rounded-xl overflow-hidden shadow-2xl bg-gray-900">
                            <img src="${m.img}" class="w-full h-full object-cover group-hover:scale-110 transition duration-700">
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                                <i class="fas fa-play text-yellow-500 text-2xl"></i>
                            </div>
                        </div>
                        <h3 class="mt-3 font-bold text-xs truncate text-gray-300 group-hover:text-yellow-500 transition">${m.title}</h3>
                    </div>`;
                if (i < 5) {
                    thumbBox.innerHTML += `
                        <div class="thumb-item" onclick="updateBanner(${i})">
                            <img src="${m.img}" class="w-full h-full object-cover">
                        </div>`;
                }
            });
        }

        async function playMovie(i) {
            const m = movies[i];
            const overlay = document.getElementById('player-overlay');
            const iframe = document.getElementById('main-iframe');
            const epBox = document.getElementById('episode-list');
            
            document.getElementById('player-title').innerText = m.title;
            overlay.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            epBox.innerHTML = "";

            if (m.isCustom) {
                // Nếu là phim riêng, lấy link từ customData
                m.episodes.forEach(ep => {
                    const btn = document.createElement('button');
                    btn.className = "bg-red-700 text-white px-4 py-1 rounded-md text-sm font-bold hover:bg-red-600";
                    btn.innerText = ep.name;
                    btn.onclick = () => { iframe.src = ep.link; };
                    epBox.appendChild(btn);
                });
                iframe.src = m.episodes[0].link;
            } else {
                // Nếu là phim API
                try {
                    const res = await fetch(`https://phimapi.com/phim/${m.slug}`);
                    const data = await res.json();
                    data.episodes[0].server_data.forEach(ep => {
                        const btn = document.createElement('button');
                        btn.className = "bg-gray-700 text-white px-4 py-1 rounded-md text-sm hover:bg-yellow-600";
                        btn.innerText = ep.name;
                        btn.onclick = () => { iframe.src = ep.link_embed; };
                        epBox.appendChild(btn);
                    });
                    iframe.src = data.episodes[0].server_data[0].link_embed;
                } catch (e) { alert("Lỗi tải phim!"); }
            }
        }

        function updateBanner(index) {
            if (movies.length === 0) return;
            cur = index;
            const m = movies[cur];
            const bg = document.getElementById('banner-bg');
            bg.style.opacity = 0;
            setTimeout(() => {
                bg.style.backgroundImage = `url('${m.img}')`;
                document.getElementById('title').innerText = m.title;
                document.getElementById('sub').innerText = m.sub;
                document.getElementById('desc').innerText = m.desc;
                document.getElementById('info-badges').innerHTML = `
                    <span class="bg-yellow-600 text-black px-2 py-0.5 rounded text-xs font-bold uppercase tracking-tighter">HD VIP</span>
                    <span class="border border-gray-500 px-2 py-0.5 rounded text-xs text-white font-medium">${m.year}</span>
                    <span class="border border-gray-500 px-2 py-0.5 rounded text-xs text-white font-medium">Vietsub</span>
                `;
                document.querySelectorAll('.thumb-item').forEach((item, idx) => {
                    idx === cur ? item.classList.add('active') : item.classList.remove('active');
                });
                bg.style.opacity = 0.6;
            }, 400);
        }

        function nextBanner() {
            if (isHovered || movies.length === 0) return;
            cur = (cur + 1) % Math.min(movies.length, 5);
            updateBanner(cur);
        }

        function startBannerCycle() {
            clearInterval(bannerInterval);
            bannerInterval = setInterval(nextBanner, AUTO_TIME);
        }

        function closePlayer() { 
            document.getElementById('player-overlay').classList.add('hidden'); 
            document.getElementById('main-iframe').src = ""; 
            document.body.style.overflow = 'auto';
        }

        function playCurrent() { playMovie(cur); }

        // Sakura Effect
        setInterval(() => {
            const s = document.createElement('div'); s.className = 'sakura';
            s.style.left = Math.random() * 100 + 'vw';
            s.style.width = s.style.height = Math.random() * 5 + 3 + 'px';
            s.style.animationDuration = Math.random() * 3 + 5 + 's';
            document.body.appendChild(s);
            setTimeout(() => s.remove(), 7000);
        }, 600);

        // Fireworks Effect
        const canvas = document.getElementById('fw-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                this.velocity = { x: (Math.random() - 0.5) * 8, y: (Math.random() - 0.5) * 8 };
                this.alpha = 1; this.friction = 0.95;
            }
            draw() {
                ctx.globalAlpha = this.alpha; ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fillStyle = this.color; ctx.fill();
            }
            update() {
                this.velocity.x *= this.friction; this.velocity.y *= this.friction;
                this.y += 0.1; this.x += this.velocity.x; this.y += this.velocity.y;
                this.alpha -= 0.01;
            }
        }
        function createFirework() {
            const x = Math.random() * canvas.width;
            const y = Math.random() * (canvas.height * 0.5);
            const color = `hsl(${Math.random() * 360}, 100%, 60%)`;
            for (let i = 0; i < 30; i++) { particles.push(new Particle(x, y, color)); }
        }
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach((p, i) => {
                if (p.alpha <= 0) particles.splice(i, 1);
                else { p.update(); p.draw(); }
            });
            if (Math.random() < 0.03) createFirework();
            requestAnimationFrame(animate);
        }
        
        animate();
        fetchInitialMovies();
    </script>
</body>
</html>
