<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xô Phim - PHIM HAY CẢ XÔ </title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --xo-vang: #d4a017; --bg-dark: #0b0c10; --tet-do: #d32f2f; --tet-hong: #ff5252; }
        body { background-color: var(--bg-dark); color: #e2e8f0; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        
        /* Header & Nav */
        #header { position: fixed; top: 0; left: 0; width: 100%; z-index: 120; background: linear-gradient(to bottom, rgba(160, 0, 0, 0.98) 0%, rgba(130, 0, 0, 0.85) 60%, transparent 100%); padding: 15px 20px 30px 20px; }
        .search-bar { background: rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 8px 15px; display: flex; align-items: center; gap: 10px; width: 100%; max-width: 400px; }
        .search-bar input { background: transparent; border: none; outline: none; color: white; font-size: 14px; width: 100%; }
        .nav-scroll { display: flex; overflow-x: auto; gap: 20px; padding: 15px 0 0 0; scrollbar-width: none; }
        .nav-item { color: rgba(255,255,255,0.9); font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: 0.3s; cursor: pointer; white-space: nowrap; }
        .nav-item:hover { color: var(--xo-vang); }

        /* Movie Cards */
        .movie-card { position: relative; border-radius: 12px; overflow: hidden; background: #1a1a20; transition: transform 0.3s ease; }
        .hover-btn { border: 2px solid var(--xo-vang); color: var(--xo-vang); padding: 5px 15px; border-radius: 99px; font-size: 11px; font-weight: 900; letter-spacing: 1px; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); transform: translateY(10px); transition: 0.3s ease; }
        .group:hover .hover-btn { transform: translateY(0); }

        /* Tết Styles */
        .bg-tet-main { background: linear-gradient(135deg, var(--tet-do) 0%, var(--tet-hong) 100%); }
        .btn-ep { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; color: #ccc; }
        .btn-ep:hover { background: var(--tet-do); color: white; border-color: white; transform: scale(1.05); }
        .btn-ep.active { background: #ffeb3b; color: #b71c1c; font-weight: 800; border-color: white; box-shadow: 0 0 15px rgba(255, 235, 59, 0.4); }
        .server-tab { padding: 6px 15px; border-radius: 6px; font-size: 12px; font-weight: 700; cursor: pointer; transition: 0.3s; background: rgba(255,255,255,0.05); color: #888; }
        .server-tab.active { background: var(--tet-do); color: white; }

        /* Sakura falling */
        .sakura { position: fixed; top: -10%; z-index: 100; pointer-events: none; background: #ffb7c5; border-radius: 50% 0 50% 50%; animation: fall linear infinite; }
        @keyframes fall { 100% { transform: translateY(110vh) rotate(720deg); opacity: 0; } }

        /* Custom Scrollbar */
        #episode-grid::-webkit-scrollbar { width: 5px; }
        #episode-grid::-webkit-scrollbar-thumb { background: var(--tet-do); border-radius: 10px; }
    </style>
</head>
<body>

    <header id="header">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div onclick="location.reload()" class="flex items-center gap-2 cursor-pointer">
                <div class="w-9 h-8 bg-[#d4a017] rounded-b-xl flex items-center justify-center">
                    <i class="fas fa-play text-black text-xs"></i>
                </div>
                <div class="flex flex-col leading-none">
                    <span class="text-xl font-black text-white tracking-tighter uppercase">XÔ PHIM</span>
                    <span class="text-[8px] text-gray-400 font-bold tracking-widest uppercase">Đức Anh Đẹp Trai</span>
                </div>
            </div>
            <div class="search-bar">
                <i id="search-icon" class="fas fa-search text-gray-400 text-sm"></i>
                <input type="text" id="searchInput" placeholder="Tìm phim (Nhấn Enter)..." onkeypress="if(event.key === 'Enter') searchMovies(this.value)">
            </div>
        </div>
        <nav class="nav-scroll">
            <div onclick="loadCustomMovies()" class="nav-item text-yellow-500 font-black"><i class="fas fa-fire"></i> PHIM YÊU CẦU</div>
            <a href="#" class="nav-item">Phim Lẻ</a>
            <a href="#" class="nav-item">Phim Bộ</a>
            <a href="#" class="nav-item">Hoạt Hình</a>
        </nav>
    </header>

    <section id="banner-section" class="relative h-[85vh] w-full pt-32 overflow-hidden">
        <div id="banner-bg" class="absolute inset-0 bg-cover bg-center transition-all duration-1000 scale-105 opacity-60"></div>
        <div class="absolute inset-0" style="background: linear-gradient(to top, var(--bg-dark) 5%, transparent 100%), linear-gradient(to right, rgba(0,0,0,0.8) 0%, transparent 60%);"></div>
        <div class="relative z-10 flex flex-col items-start justify-end h-full px-10 pb-20 max-w-4xl text-left">
            <h1 id="title" class="text-4xl md:text-6xl font-black mb-2 text-white uppercase italic tracking-tighter">ĐANG TẢI...</h1>
            <p id="sub" class="text-yellow-500 text-lg font-bold mb-4 italic">--</p>
            <p id="desc" class="text-gray-300 text-sm mb-8 line-clamp-3 italic"></p>
            <div class="flex flex-col gap-6">
                <button onclick="playCurrent()" class="bg-yellow-500 text-black w-fit px-10 py-3 rounded-full font-black hover:scale-110 transition flex items-center gap-2 shadow-[0_0_20px_rgba(212,160,23,0.3)]"><i class="fas fa-play"></i> XEM NGAY</button>
                <div id="banner-thumbs" class="flex gap-3"></div>
            </div>
        </div>
    </section>

    <div class="px-6 py-10 bg-[#0b0c10]">
        <h2 class="text-2xl font-bold mb-6 italic border-l-4 border-yellow-500 pl-4 uppercase">Bạn đang quan tâm gì?</h2>
        <div class="flex flex-wrap gap-4">
            <div onclick="searchMovies('Chính kịch')" class="relative w-44 h-28 rounded-2xl bg-blue-600 p-4 cursor-pointer transition transform hover:scale-105 shadow-lg">
                <h3 class="text-xl font-bold">Chính kịch</h3><p class="text-xs mt-2">Xem chủ đề ›</p>
            </div>
            <div onclick="searchMovies('Hành động')" class="relative w-44 h-28 rounded-2xl bg-slate-600 p-4 cursor-pointer transition transform hover:scale-105 shadow-lg">
                <h3 class="text-xl font-bold">Hành động</h3><p class="text-xs mt-2">Xem chủ đề ›</p>
            </div>
            <div onclick="searchMovies('Tình cảm')" class="relative w-44 h-28 rounded-2xl bg-orange-400 p-4 cursor-pointer transition transform hover:scale-105 shadow-lg">
                <h3 class="text-xl font-bold text-white">Tình cảm</h3><p class="text-xs mt-2 text-white">Xem chủ đề ›</p>
            </div>
            <div onclick="searchMovies('Hoạt hình')" class="relative w-44 h-28 rounded-2xl bg-red-800 p-4 cursor-pointer transition transform hover:scale-105 shadow-lg">
                <h3 class="text-xl font-bold">Hoạt hình</h3><p class="text-xs mt-2">Xem chủ đề ›</p>
            </div>
        </div>
    </div>

    <main class="px-6 pb-20">
        <h2 id="grid-title" class="text-xl font-extrabold italic uppercase mb-8 border-l-4 border-red-600 pl-4">Phim Mới Cập Nhật</h2>
        <div id="movie-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-6"></div>
    </main>

    <div id="player-overlay" class="fixed inset-0 z-[200] hidden bg-[#0b0c10] flex flex-col overflow-hidden">
        <div class="bg-tet-main p-4 flex justify-between items-center shadow-xl">
            <button onclick="closePlayer()" class="text-white font-bold flex items-center gap-2 hover:opacity-80 transition">
                <i class="fas fa-arrow-left"></i> QUAY LẠI
            </button>
            <h2 id="player-title-header" class="text-white font-black uppercase italic tracking-tighter truncate px-4 text-sm md:text-base"></h2>
            <div class="flex gap-4 text-white/80">
                <i class="fas fa-cog cursor-pointer hover:text-white"></i>
            </div>
        </div>

        <div class="flex-1 bg-black flex items-center justify-center relative shadow-[inset_0_0_100px_rgba(0,0,0,0.5)]">
            <iframe id="main-iframe" class="w-full h-full" frameborder="0" allowfullscreen></iframe>
        </div>

        <div class="bg-[#0f1115] border-t border-white/5 p-4 md:p-6 overflow-y-auto" style="max-height: 40vh;">
            <div class="max-w-6xl mx-auto">
                <div class="flex flex-col md:flex-row justify-between items-start gap-4 mb-6">
                    <div>
                        <h2 id="player-info-name" class="text-xl md:text-2xl font-black text-white italic uppercase tracking-tighter"></h2>
                        <div class="flex items-center gap-3 mt-2">
                            <span class="bg-yellow-500 text-black px-2 py-0.5 rounded text-[10px] font-black">2026</span>
                            <span class="border border-gray-600 text-gray-400 px-2 py-0.5 rounded text-[10px] uppercase font-bold tracking-widest">Phần 1</span>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button class="bg-white/5 hover:bg-white/10 text-white px-4 py-2 rounded-lg text-xs font-bold transition flex items-center gap-2">
                            <i class="fas fa-share-alt"></i> CHIA SẺ
                        </button>
                    </div>
                </div>

                <div class="flex flex-wrap items-center gap-4 mb-6">
                    <div class="flex bg-white/5 p-1 rounded-lg">
                        <div class="server-tab active" id="tab-sub">Phụ đề #1</div>
                        <div class="server-tab" id="tab-tm">Thuyết minh #1</div>
                    </div>
                    <span class="text-[10px] text-gray-500 italic uppercase">Lưu ý: Đổi server nếu phim lỗi</span>
                </div>

                <div class="grid grid-cols-3 sm:grid-cols-5 md:grid-cols-8 lg:grid-cols-10 gap-3" id="episode-grid">
                    </div>
            </div>
        </div>
    </div>

    <script>
        const customData = [
            { id: 18, title: "Mưa Đỏ", sub: "Red Rain", year: "2026", status: "YouTube", subType: "TM", img: "https://mir-s3-cdn-cf.behance.net/project_modules/1400_webp/0b1372232709307.68a20d789415d.jpg", episodes: [{ name: "1", link: "https://www.youtube.com/embed/9Ymlum6nHq4" }], desc: "Một câu chuyện đầy kịch tính và cảm xúc trong cơn mưa đỏ định mệnh." },
            { id: 17, title: "Quang Phổ", sub: "Spectral", year: "2026", status: "Bản Đẹp", subType: "Vietsub", img: "https://phimapi.com/image.php?url=https://phimimg.com/upload/vod/20260116-1/5b1f85f0fbcc96ca4bad610602025626.jpg", episodes: [{ name: "1", link: "https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260116/KvfgltMI/index.m3u8" }], desc: "Cuộc chiến chống lại những thực thể siêu nhiên không thể nhìn thấy." }
        ];

        let movies = []; let cur = 0; let bannerInterval;

        async function fetchInitialMovies() {
            try {
                const res = await fetch('https://phimapi.com/danh-sach/phim-moi-cap-nhat?page=1');
                const data = await res.json();
                processData(data.items);
            } catch (e) { console.error(e); }
        }

        async function searchMovies(query) {
            if (!query.trim()) return;
            const gridTitle = document.getElementById('grid-title');
            const movieGrid = document.getElementById('movie-grid');
            const searchIcon = document.getElementById('search-icon');
            searchIcon.className = "fas fa-spinner fa-spin text-yellow-500";
            gridTitle.innerHTML = `<i class="fas fa-search fa-spin text-yellow-500"></i> ĐANG TÌM: "${query.toUpperCase()}"...`;
            window.scrollTo({top: 800, behavior: 'smooth'});
            try {
                const res = await fetch(`https://phimapi.com/v1/api/tim-kiem?keyword=${encodeURIComponent(query)}&limit=12`);
                const data = await res.json();
                searchIcon.className = "fas fa-search text-gray-400";
                if (data.data && data.data.items.length > 0) {
                    gridTitle.innerHTML = `<i class="fas fa-check-circle text-green-500"></i> KẾT QUẢ: "${query.toUpperCase()}"`;
                    movies = data.data.items.map(item => ({
                        title: item.name, sub: item.origin_name, img: `https://phimimg.com/${item.thumb_url}`,
                        year: item.year || "2026", slug: item.slug, status: "HD", subType: "Vietsub", desc: "Dữ liệu từ máy chủ PhimAPI."
                    }));
                    renderGrid();
                } else {
                    gridTitle.innerHTML = `<i class="fas fa-times-circle text-red-500"></i> KHÔNG TÌM THẤY`;
                    movieGrid.innerHTML = `<div class="col-span-full text-center py-20 bg-white/5 rounded-3xl border border-dashed border-gray-800"><p class="text-xl font-bold">Xin lỗi, chưa có phim: "${query}"</p></div>`;
                }
            } catch (e) { searchIcon.className = "fas fa-search text-gray-400"; }
        }

        function processData(items) {
            movies = items.map(item => ({
                title: item.name, sub: item.origin_name, img: item.thumb_url.startsWith('http') ? item.thumb_url : `https://phimimg.com/${item.thumb_url}`,
                year: item.year || "2026", slug: item.slug, status: "HD", subType: "Vietsub", desc: "Chào mừng bạn đến với Xô Phim - Phim Hay Cả Xô."
            }));
            renderGrid(); updateBanner(0); startBannerCycle();
        }

        function renderGrid() {
            const grid = document.getElementById('movie-grid');
            const thumbBox = document.getElementById('banner-thumbs');
            grid.innerHTML = ""; thumbBox.innerHTML = "";
            movies.forEach((m, i) => {
                grid.innerHTML += `<div class="cursor-pointer group" onclick="playMovie(${i})"><div class="movie-card aspect-[2/3] shadow-2xl"><img src="${m.img}" class="w-full h-full object-cover group-hover:scale-110 transition duration-700"><div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition flex items-center justify-center"><span class="hover-btn">PHÁT NGAY</span></div></div><div class="mt-3 text-center px-1"><h3 class="font-bold text-[13px] text-gray-200 group-hover:text-yellow-500 truncate uppercase tracking-tighter">${m.title}</h3></div></div>`;
                if (i < 5) thumbBox.innerHTML += `<div class="thumb-item ${i===cur?'active':''}" onclick="updateBanner(${i})"><img src="${m.img}" class="w-full h-full object-cover"></div>`;
            });
        }

        async function playMovie(i) {
            const m = movies[i];
            const overlay = document.getElementById('player-overlay');
            const iframe = document.getElementById('main-iframe');
            const epGrid = document.getElementById('episode-grid');
            
            document.getElementById('player-title-header').innerText = m.title;
            document.getElementById('player-info-name').innerText = m.title;
            overlay.classList.remove('hidden');
            epGrid.innerHTML = `<p class="text-white text-xs">Đang tải tập...</p>`;

            if (m.isCustom) {
                renderEpButtons(m.episodes, iframe);
                iframe.src = m.episodes[0].link;
            } else {
                try {
                    const res = await fetch(`https://phimapi.com/phim/${m.slug}`);
                    const data = await res.json();
                    const sData = data.episodes[0].server_data;
                    renderEpButtons(sData, iframe);
                    iframe.src = sData[0].link_embed;
                } catch (e) { epGrid.innerHTML = "Lỗi tải phim!"; }
            }
        }

        function renderEpButtons(data, iframe) {
            const epGrid = document.getElementById('episode-grid');
            epGrid.innerHTML = "";
            data.forEach((ep, idx) => {
                const btn = document.createElement('button');
                btn.className = `btn-ep py-2 px-3 rounded-lg text-xs font-bold ${idx===0?'active':''}`;
                btn.innerText = `TẬP ${ep.name}`;
                btn.onclick = () => {
                    document.querySelectorAll('.btn-ep').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    iframe.src = ep.link_embed || ep.link;
                };
                epGrid.appendChild(btn);
            });
        }

        function updateBanner(index) {
            if (movies.length === 0) return;
            cur = index; const m = movies[cur];
            document.getElementById('banner-bg').style.backgroundImage = `url('${m.img}')`;
            document.getElementById('title').innerText = m.title;
            document.getElementById('sub').innerText = m.sub;
            document.getElementById('desc').innerText = m.desc;
            document.querySelectorAll('.thumb-item').forEach((it, idx) => idx === cur ? it.classList.add('active') : it.classList.remove('active'));
        }

        function startBannerCycle() {
            clearInterval(bannerInterval);
            bannerInterval = setInterval(() => { cur = (cur + 1) % 5; updateBanner(cur); }, 5000);
        }

        function closePlayer() { document.getElementById('player-overlay').classList.add('hidden'); document.getElementById('main-iframe').src = ""; }
        function playCurrent() { playMovie(cur); }
        function loadCustomMovies() { movies = customData.map(d => ({...d, isCustom:true})); renderGrid(); }

        // Hiệu ứng Sakura
        setInterval(() => {
            const s = document.createElement('div'); s.className = 'sakura';
            s.style.left = Math.random() * 100 + 'vw';
            s.style.width = s.style.height = Math.random() * 6 + 4 + 'px';
            s.style.animationDuration = Math.random() * 3 + 4 + 's';
            document.body.appendChild(s);
            setTimeout(() => s.remove(), 6000);
        }, 500);

        fetchInitialMovies();
    </script>
</body>
</html>
